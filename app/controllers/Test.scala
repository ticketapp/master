package controllers

import java.io.{IOException, FileNotFoundException}
import java.math.MathContext
import java.text.Normalizer
import java.util.Date
import play.api.libs.iteratee.{Iteratee, Enumerator}
import play.api.libs.ws.WS
import play.api.libs.ws.Response
import play.api.mvc._
import play.libs.F.Promise
import scala.concurrent.Future
import play.api.libs.json._
import play.api.libs.concurrent.Execution.Implicits._
import models.Event
import scala.io.Source
import play.api.mvc.Results._
import scala.util.{Success, Failure}
import services.Utilities._

object Test extends Controller{

  /*def test1 = WebSocket.using[String] { request =>
    // Log events to the console
    val in = Iteratee.foreach[String](println).map { _ =>
      println("Disconnecteddddd")
    }

    // Send a single 'Hello!' message
    val out = Enumerator("Hello!")

    (in, out)
  }*/

  def mock(serviceName: String) = {
    val start = System.currentTimeMillis()
    def getLatency(r: Any): Long = System.currentTimeMillis() - start
    val token = play.Play.application.configuration.getString("facebook.token")
    val soundCloudClientId = play.Play.application.configuration.getString("soundCloud.clientId")
    val echonestApiKey = play.Play.application.configuration.getString("echonest.apiKey")
    val youtubeKey = play.Play.application.configuration.getString("youtube.key")
    serviceName match {
      case "a" =>
        WS.url("http://api.soundcloud.com/users/rone-music?client_id=" +
          soundCloudClientId).get().map { response => Json.toJson("yo")}
      case "b" =>
        WS.url("https://graph.facebook.com/v2.2/search?q=" + "iam"
          + "&type=page&fields=name,cover%7Bsource%7D,id,category,link,website&access_token=" + token).get()
          .map { response => Json.toJson("sacoche!!!")}
      case _ => WS.url("https://graph.facebook.com/v2.2/search?q=" + "iam"
        + "&type=page&fields=name,cover%7Bsource%7D,id,category,link,website&access_token=" + token).get()
        .map { response => Json.toJson("???!!!")}
    }
  }


  def test1 = Action {
    Ok(Json.toJson(Json.parse("""[{"kind":"track","id":191289253,"created_at":"2015/02/15 18:53:56 +0000","user_id":39177145,"duration":447989,"commentable":true,"state":"finished","original_content_size":79005024,"last_modified":"2015/02/15 21:36:28 +0000","sharing":"public","tag_list":"\"kmplx scribe\" Techno \"swedish techno\" malmö","permalink":"ascorbite-cryptic-original-mix","streamable":true,"embeddable_by":"all","downloadable":true,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"Techno","title":"KMPLX Scribe - Cryptic (Original Mix)","description":"This is my first EP made under my second alias KMPLX Scribe, which is the darker, harsher and colder side of my techno productions. Play it, spread the word and support your local underground techno producer.\r\n\r\nMastering creds goes to Per Hammar at Valvet.\r\n\r\nDas leben ist ein ponyhof.","label_name":"","release":"","track_type":"original","key_signature":"","isrc":"","video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/191289253","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-cryptic-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000106826222-sp3hfw-large.jpg","waveform_url":"https://w1.sndcdn.com/PhdvQERQV1np_m.png","stream_url":"https://api.soundcloud.com/tracks/191289253/stream","download_url":"https://api.soundcloud.com/tracks/191289253/download","playback_count":138,"download_count":5,"favoritings_count":4,"comment_count":5,"attachments_uri":"https://api.soundcloud.com/tracks/191289253/attachments","policy":"ALLOW"},{"kind":"track","id":191289251,"created_at":"2015/02/15 18:53:56 +0000","user_id":39177145,"duration":504236,"commentable":true,"state":"finished","original_content_size":88928372,"last_modified":"2015/02/15 21:38:33 +0000","sharing":"public","tag_list":"\"kmplx scribe\" Techno \"swedish techno\" malmö","permalink":"ascorbite-subtil-original-mix","streamable":true,"embeddable_by":"all","downloadable":true,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"Techno","title":"KMPLX Scribe - Subtil (Original Mix)","description":"This is my first EP made under my second alias KMPLX Scribe, which is the darker, harsher and colder side of my techno productions. Play it, spread the word and support your local underground techno producer.\r\n\r\nMastering creds goes to Per Hammar at Valvet.\r\n\r\nDas leben ist ein ponyhof.","label_name":"","release":"","track_type":"original","key_signature":"","isrc":"","video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/191289251","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-subtil-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000106826220-26k4ox-large.jpg","waveform_url":"https://w1.sndcdn.com/57pYtKzoFklY_m.png","stream_url":"https://api.soundcloud.com/tracks/191289251/stream","download_url":"https://api.soundcloud.com/tracks/191289251/download","playback_count":54,"download_count":5,"favoritings_count":4,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/191289251/attachments","policy":"ALLOW"},{"kind":"track","id":185566700,"created_at":"2015/01/11 20:40:49 +0000","user_id":39177145,"duration":2477971,"commentable":true,"state":"finished","original_content_size":99111747,"last_modified":"2015/01/12 21:26:30 +0000","sharing":"public","tag_list":"Techno \"hard techno\" Live","permalink":"ascorbite-live-at-sntx","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Ascorbite Live At SNTX (Reuploaded)","description":"Here is my live set from my gig at SNTX in Malmö, Sweden, where I shared the booth together with Nihad Tule and Martin Emess. Thank you for recording it Nihad!\n\n(Reuploaded due to a fuck-up by Soundcloud)","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/185566700","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-live-at-sntx","artwork_url":"https://i1.sndcdn.com/artworks-000103016093-c3ajnd-large.jpg","waveform_url":"https://w1.sndcdn.com/m3OuE4AlSOGv_m.png","stream_url":"https://api.soundcloud.com/tracks/185566700/stream","playback_count":53,"download_count":0,"favoritings_count":2,"comment_count":2,"attachments_uri":"https://api.soundcloud.com/tracks/185566700/attachments","policy":"ALLOW"},{"kind":"track","id":185561163,"created_at":"2015/01/11 20:03:52 +0000","user_id":39177145,"duration":493316,"commentable":true,"state":"finished","original_content_size":19729123,"last_modified":"2015/01/11 22:42:30 +0000","sharing":"public","tag_list":"techno Experimental malmö sweden \"edgar ariza\" \"ct 01\" ct02 ct03","permalink":"ascorbite-ct01-phmaster","streamable":true,"embeddable_by":"all","downloadable":true,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Ascorbite - CT01","description":"Here is a somewhat hypnotic and deep techno 3 tracker for all of you to download and enjoy FOR FREE. \n\nMastered by Per Hammar at Valvet, Malmö.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/185561163","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-ct01-phmaster","artwork_url":"https://i1.sndcdn.com/artworks-000103012335-w6zfqp-large.jpg","waveform_url":"https://w1.sndcdn.com/DLVm0hMDB7p3_m.png","stream_url":"https://api.soundcloud.com/tracks/185561163/stream","download_url":"https://api.soundcloud.com/tracks/185561163/download","playback_count":333,"download_count":13,"favoritings_count":3,"comment_count":2,"attachments_uri":"https://api.soundcloud.com/tracks/185561163/attachments","policy":"ALLOW"},{"kind":"track","id":185561161,"created_at":"2015/01/11 20:03:52 +0000","user_id":39177145,"duration":484825,"commentable":true,"state":"finished","original_content_size":19389283,"last_modified":"2015/01/11 22:42:15 +0000","sharing":"public","tag_list":"techno Experimental malmö sweden \"edgar ariza\" \"ct 01\" ct02 ct03","permalink":"ascorbite-ct02-phmaster","streamable":true,"embeddable_by":"all","downloadable":true,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Ascorbite - CT02","description":"Here is a somewhat hypnotic and deep techno 3 tracker for all of you to download and enjoy FOR FREE. \n\nMastered by Per Hammar at Valvet, Malmö.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/185561161","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-ct02-phmaster","artwork_url":"https://i1.sndcdn.com/artworks-000103012334-hhhg7o-large.jpg","waveform_url":"https://w1.sndcdn.com/lOlhSWgYybpm_m.png","stream_url":"https://api.soundcloud.com/tracks/185561161/stream","download_url":"https://api.soundcloud.com/tracks/185561161/download","playback_count":151,"download_count":8,"favoritings_count":3,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/185561161/attachments","policy":"ALLOW"},{"kind":"track","id":185561160,"created_at":"2015/01/11 20:03:51 +0000","user_id":39177145,"duration":457393,"commentable":true,"state":"finished","original_content_size":18292963,"last_modified":"2015/01/11 22:42:41 +0000","sharing":"public","tag_list":"techno Experimental malmö sweden \"edgar ariza\" \"ct 01\" ct02 ct03","permalink":"ascorbite-ct03-phmaster","streamable":true,"embeddable_by":"all","downloadable":true,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Ascorbite - CT03","description":"Here is a somewhat hypnotic and deep techno 3 tracker for all of you to download and enjoy FOR FREE. \n\nMastered by Per Hammar at Valvet, Malmö.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/185561160","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-ct03-phmaster","artwork_url":"https://i1.sndcdn.com/artworks-000103012333-g82vok-large.jpg","waveform_url":"https://w1.sndcdn.com/TbsMMl7sfrzn_m.png","stream_url":"https://api.soundcloud.com/tracks/185561160/stream","download_url":"https://api.soundcloud.com/tracks/185561160/download","playback_count":81,"download_count":7,"favoritings_count":2,"comment_count":1,"attachments_uri":"https://api.soundcloud.com/tracks/185561160/attachments","policy":"ALLOW"},{"kind":"track","id":174409947,"created_at":"2014/10/29 16:23:05 +0000","user_id":39177145,"duration":459823,"commentable":true,"state":"finished","original_content_size":11034121,"last_modified":"2014/10/29 16:23:05 +0000","sharing":"public","tag_list":"techno \"hard techno\"","permalink":"heliotrope-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Heliotrope (Original Mix)","description":"Das leben ist ein ponyhof.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/174409947","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/heliotrope-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000095499752-houx2h-large.jpg","waveform_url":"https://w1.sndcdn.com/SzRKg3xnDJ10_m.png","stream_url":"https://api.soundcloud.com/tracks/174409947/stream","playback_count":261,"download_count":0,"favoritings_count":7,"comment_count":4,"attachments_uri":"https://api.soundcloud.com/tracks/174409947/attachments","policy":"ALLOW"},{"kind":"track","id":171636735,"created_at":"2014/10/11 12:45:22 +0000","user_id":39177145,"duration":489501,"commentable":true,"state":"finished","original_content_size":19577241,"last_modified":"2014/10/12 15:33:19 +0000","sharing":"public","tag_list":"Techno hardtechno \"edgar ariza\" malmö quokka","permalink":"tiny-qoukka-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Tiny Quokka (Original Mix)","description":"What if the Quokka ISN'T the happiest animal on the planet? How do we know that the cute little smile it always seems to have isn't in fact fake?\n\n\nDas leben ist ein ponyhof","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/171636735","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/tiny-qoukka-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000093619101-lwa2fk-large.jpg","waveform_url":"https://w1.sndcdn.com/LlwthhFB6da5_m.png","stream_url":"https://api.soundcloud.com/tracks/171636735/stream","playback_count":483,"download_count":0,"favoritings_count":6,"comment_count":1,"attachments_uri":"https://api.soundcloud.com/tracks/171636735/attachments","policy":"ALLOW"},{"kind":"track","id":170747700,"created_at":"2014/10/05 16:34:06 +0000","user_id":39177145,"duration":433960,"commentable":true,"state":"finished","original_content_size":76533204,"last_modified":"2014/10/05 16:34:08 +0000","sharing":"public","tag_list":"Techno malmö Experimental","permalink":"harbour-wave-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Harbour Wave (Original Mix)","description":"\"Smooth sailing is for pussies. I want there to be fucking tsunamis.\"\n\nDas leben ist ein ponyhof.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/170747700","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/harbour-wave-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000093017919-2emmdt-large.jpg","waveform_url":"https://w1.sndcdn.com/jLNQHej9cThx_m.png","stream_url":"https://api.soundcloud.com/tracks/170747700/stream","playback_count":325,"download_count":0,"favoritings_count":5,"comment_count":3,"attachments_uri":"https://api.soundcloud.com/tracks/170747700/attachments","policy":"ALLOW"},{"kind":"track","id":169159081,"created_at":"2014/09/24 13:53:20 +0000","user_id":39177145,"duration":406137,"commentable":true,"state":"finished","original_content_size":16242971,"last_modified":"2014/09/24 14:21:52 +0000","sharing":"public","tag_list":"Techno Experimental malmö","permalink":"ddk-45-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Ddk - 45 (Original Mix)","description":"Das leben ist ein ponyhof.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/169159081","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ddk-45-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000091996410-6skwhi-large.jpg","waveform_url":"https://w1.sndcdn.com/SRNP6iJiWFUu_m.png","stream_url":"https://api.soundcloud.com/tracks/169159081/stream","playback_count":222,"download_count":0,"favoritings_count":3,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/169159081/attachments","policy":"ALLOW"},{"kind":"track","id":168988433,"created_at":"2014/09/23 10:50:10 +0000","user_id":39177145,"duration":423823,"commentable":true,"state":"finished","original_content_size":16949986,"last_modified":"2014/09/23 10:51:01 +0000","sharing":"public","tag_list":"Techno malmö \"edgar ariza\" \"edgar ariza music\"","permalink":"coping-original-mix","streamable":true,"embeddable_by":"all","downloadable":true,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Coping (Original Mix)","description":"Mastering by Martin Nordbeck\n\nhttps://soundcloud.com/nordbeck","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/168988433","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/coping-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000091879436-4bi81v-large.jpg","waveform_url":"https://w1.sndcdn.com/SjdST4nGiXLG_m.png","stream_url":"https://api.soundcloud.com/tracks/168988433/stream","download_url":"https://api.soundcloud.com/tracks/168988433/download","playback_count":149,"download_count":11,"favoritings_count":3,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/168988433/attachments","policy":"ALLOW"},{"kind":"track","id":168988431,"created_at":"2014/09/23 10:50:09 +0000","user_id":39177145,"duration":461600,"commentable":true,"state":"finished","original_content_size":18461026,"last_modified":"2014/09/23 10:51:01 +0000","sharing":"public","tag_list":"Techno malmö \"edgar ariza\" \"edgar ariza music\"","permalink":"sensible-original-mix","streamable":true,"embeddable_by":"all","downloadable":true,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"ascorbite","title":"Sensible (Original Mix)","description":"Mastering by Martin Nordbeck\n\nhttps://soundcloud.com/nordbeck","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/168988431","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/sensible-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000091879435-ag19ri-large.jpg","waveform_url":"https://w1.sndcdn.com/bD07zLGdFVcw_m.png","stream_url":"https://api.soundcloud.com/tracks/168988431/stream","download_url":"https://api.soundcloud.com/tracks/168988431/download","playback_count":97,"download_count":7,"favoritings_count":2,"comment_count":1,"attachments_uri":"https://api.soundcloud.com/tracks/168988431/attachments","policy":"ALLOW"},{"kind":"track","id":164831406,"created_at":"2014/08/26 11:29:30 +0000","user_id":39177145,"duration":469229,"commentable":true,"state":"finished","original_content_size":18766400,"last_modified":"2015/01/19 20:34:34 +0000","sharing":"public","tag_list":"Techno Hardtechno malmö kmplxscribe","permalink":"ascorbite-graphic-nature-original-mix-1","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"Graphic Nature (Original Mix)","title":"KMPLX Scribe - Graphic Nature (Original Mix)","description":"Unsigned track under my alias KMPLX Scribe, made in early may 2014.\n\nDas leben ist ein ponyhof.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/164831406","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-graphic-nature-original-mix-1","artwork_url":"https://i1.sndcdn.com/artworks-000089167187-ddp4u7-large.jpg","waveform_url":"https://w1.sndcdn.com/lFOmGjLXjzQ8_m.png","stream_url":"https://api.soundcloud.com/tracks/164831406/stream","playback_count":200,"download_count":0,"favoritings_count":4,"comment_count":2,"attachments_uri":"https://api.soundcloud.com/tracks/164831406/attachments","policy":"ALLOW"},{"kind":"track","id":164830929,"created_at":"2014/08/26 11:24:33 +0000","user_id":39177145,"duration":417370,"commentable":true,"state":"finished","original_content_size":16692277,"last_modified":"2015/01/19 20:32:44 +0000","sharing":"public","tag_list":"Techno malmö edgararizamusic kmplxscribe","permalink":"peculiar-inside-original-mix-1","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"Peculiar Inside (Original Mix)","title":"KMPLX Scribe - Peculiar Inside (Original Mix)","description":"Unsigned track under my alias KMPLX Scribe, made in early may 2014.\n\nDas leben ist ein ponyhof.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"mp3","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/164830929","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/peculiar-inside-original-mix-1","artwork_url":"https://i1.sndcdn.com/artworks-000089166920-gqii5z-large.jpg","waveform_url":"https://w1.sndcdn.com/vyvxfEZMprcY_m.png","stream_url":"https://api.soundcloud.com/tracks/164830929/stream","playback_count":94,"download_count":0,"favoritings_count":2,"comment_count":1,"attachments_uri":"https://api.soundcloud.com/tracks/164830929/attachments","policy":"ALLOW"},{"kind":"track","id":162688873,"created_at":"2014/08/11 17:18:55 +0000","user_id":39177145,"duration":459327,"commentable":true,"state":"finished","original_content_size":121508282,"last_modified":"2014/08/11 17:22:58 +0000","sharing":"public","tag_list":"\"Habitual (Original Mix)\" \"Edgar Ariza\" Techno Electronica Malmö","permalink":"habitual-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"Ascorbite","title":"Habitual (Original Mix)","description":"Unsigned. \n\nA little of this, little of that. Das leben ist ein ponyhof.","label_name":null,"release":null,"track_type":null,"key_signature":null,"isrc":null,"video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/162688873","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/habitual-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000087773436-cpl3nn-large.jpg","waveform_url":"https://w1.sndcdn.com/KQeK80OfXOue_m.png","stream_url":"https://api.soundcloud.com/tracks/162688873/stream","playback_count":88,"download_count":0,"favoritings_count":3,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/162688873/attachments","policy":"ALLOW"},{"kind":"track","id":151644885,"created_at":"2014/05/28 09:48:19 +0000","user_id":39177145,"duration":434117,"commentable":true,"state":"finished","original_content_size":114837056,"last_modified":"2014/08/08 16:49:21 +0000","sharing":"public","tag_list":"nordpoolen Techno \"edgar ariza\" malmö","permalink":"nordpoolen-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"Techno","title":"Nordpoolen (Original Mix)","description":"Unsigned.","label_name":"","release":"","track_type":"original","key_signature":"","isrc":"","video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/151644885","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/nordpoolen-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000080726002-vv9adp-large.jpg","waveform_url":"https://w1.sndcdn.com/i3g2ZUMHjzpH_m.png","stream_url":"https://api.soundcloud.com/tracks/151644885/stream","playback_count":215,"download_count":0,"favoritings_count":4,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/151644885/attachments","policy":"ALLOW"},{"kind":"track","id":151644621,"created_at":"2014/05/28 09:45:20 +0000","user_id":39177145,"duration":365879,"commentable":true,"state":"finished","original_content_size":96784028,"last_modified":"2014/08/08 16:50:19 +0000","sharing":"public","tag_list":"sekundmeter techno Electro edgar ariza malmö","permalink":"sekundmeter-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"Techno","title":"Sekundmeter (Original Mix)","description":"Das leben ist ein ponyhof. Es la verdad.","label_name":"","release":"","track_type":"original","key_signature":"","isrc":"","video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/151644621","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/sekundmeter-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000080725832-ru85pd-large.jpg","waveform_url":"https://w1.sndcdn.com/KddDjIl6xzpn_m.png","stream_url":"https://api.soundcloud.com/tracks/151644621/stream","playback_count":72,"download_count":0,"favoritings_count":3,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/151644621/attachments","policy":"ALLOW"},{"kind":"track","id":150615286,"created_at":"2014/05/21 18:40:25 +0000","user_id":39177145,"duration":378549,"commentable":true,"state":"finished","original_content_size":100141556,"last_modified":"2014/05/27 10:37:07 +0000","sharing":"public","tag_list":"ascorbite grogrund edgar ariza techno electro malmö","permalink":"grogrund-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"techno","title":"Grogrund (Original Mix)","description":"Unsigned","label_name":"","release":"","track_type":"original","key_signature":"","isrc":"","video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/150615286","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/grogrund-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000080625105-x56vck-large.jpg","waveform_url":"https://w1.sndcdn.com/7om1dnH4i5Tr_m.png","stream_url":"https://api.soundcloud.com/tracks/150615286/stream","playback_count":78,"download_count":0,"favoritings_count":2,"comment_count":1,"attachments_uri":"https://api.soundcloud.com/tracks/150615286/attachments","policy":"ALLOW"},{"kind":"track","id":150119531,"created_at":"2014/05/18 15:11:50 +0000","user_id":39177145,"duration":416743,"commentable":true,"state":"finished","original_content_size":110243486,"last_modified":"2014/05/27 10:38:03 +0000","sharing":"public","tag_list":"nevro \"edgar ariza\" Techno electro malmö","permalink":"ascorbite-nevro-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"techno","title":"Nevro (Original Mix)","description":"Unreleased.","label_name":"","release":"","track_type":"original","key_signature":"","isrc":"","video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/150119531","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-nevro-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000080625144-2c33u8-large.jpg","waveform_url":"https://w1.sndcdn.com/xApGIZHBJmmw_m.png","stream_url":"https://api.soundcloud.com/tracks/150119531/stream","playback_count":135,"download_count":0,"favoritings_count":2,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/150119531/attachments","policy":"ALLOW"},{"kind":"track","id":150118810,"created_at":"2014/05/18 15:06:01 +0000","user_id":39177145,"duration":432105,"commentable":true,"state":"finished","original_content_size":114307856,"last_modified":"2014/05/19 22:27:33 +0000","sharing":"public","tag_list":"vossia \"edgar ariza\" Techno malmö","permalink":"ascorbite-vossia-original-mix","streamable":true,"embeddable_by":"all","downloadable":false,"purchase_url":null,"label_id":null,"purchase_title":null,"genre":"techno","title":"Vossia (Original Mix)","description":"Unreleased","label_name":"","release":"","track_type":"original","key_signature":"","isrc":"","video_url":null,"bpm":null,"release_year":null,"release_month":null,"release_day":null,"original_format":"wav","license":"all-rights-reserved","uri":"https://api.soundcloud.com/tracks/150118810","user":{"id":39177145,"kind":"user","permalink":"ascorbite","username":"Ascorbite","last_modified":"2015/02/25 13:13:16 +0000","uri":"https://api.soundcloud.com/users/39177145","permalink_url":"http://soundcloud.com/ascorbite","avatar_url":"https://i1.sndcdn.com/avatars-000085891320-p5gvez-large.jpg"},"permalink_url":"http://soundcloud.com/ascorbite/ascorbite-vossia-original-mix","artwork_url":"https://i1.sndcdn.com/artworks-000079790611-3wwfdj-large.jpg","waveform_url":"https://w1.sndcdn.com/UMjlF2y1TLAs_m.png","stream_url":"https://api.soundcloud.com/tracks/150118810/stream","playback_count":54,"download_count":0,"favoritings_count":1,"comment_count":0,"attachments_uri":"https://api.soundcloud.com/tracks/150118810/attachments","policy":"ALLOW"}]""")))
  }

  val echonestBaseUrl = play.Play.application.configuration.getString("echonest.baseUrl")
  val echonestApiKey = play.Play.application.configuration.getString("echonest.apiKey")
  def getEchonestSongs(start: Long, echonestArtistId: String): Future[Set[String]] = {
    val endpoint = s"$echonestBaseUrl/artist/songs"
    val assembledUrl = s"$endpoint?api_key=$echonestApiKey&id=$echonestArtistId&format=json&start=$start&results=100"
    val response = WS.url(assembledUrl).get()
    val futureJson = response map (_.json)

    futureJson flatMap { result =>
      val total = (result \ "response" \ "total").asOpt[Int]
      val songs = (result \ "response" \ "songs").asOpt[Set[String]]
      total exists (_ > start + 100) match {
        case false => Future.successful(getTitleSetFromJson(result))
        case true => getEchonestSongs(start + 100, echonestArtistId) map (getTitleSetFromJson(result) ++ _)
      }
    }
  }

  def getTitleSetFromJson( jsValue: JsValue ): Set[ String ] = {
    val titleReads: Reads[Option[String]] = (__ \\ "title").readNullable[String]
    (jsValue \ "response" \ "songs")
      .asOpt[Set[Option[String]]](Reads.set(titleReads))
      .getOrElse(Set.empty)
      .flatten
  }


  def getEchoSongs(echonestArtistId: String) = Action.async {
    getEchonestSongs(0, echonestArtistId) map { result =>
      Ok(Json.toJson(result))
    }
  }
}
